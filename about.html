<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About - Welcome to Japan</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables are provided by the canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;

        // Function to initialize Firebase and authenticate
        const initializeFirebase = async () => {
            try {
                // Initialize Firebase app
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Authenticate the user using the custom token
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                console.log("Firebase initialized and user authenticated.");
            } catch (error) {
                console.error("Error initializing Firebase or authenticating:", error);
                // Handle initialization errors gracefully
                document.getElementById('form-status').textContent = 'Error: Could not connect to the database. Please try again later.';
                document.getElementById('form-status').classList.add('text-red-600');
                document.getElementById('submit-button').disabled = true;
            }
        };

        // Call the initialization function when the script loads
        initializeFirebase();

        window.lucide = lucide;
        window.formHandler = {
            addDoc,
            collection,
            db,
            auth,
            appId,
        };
    </script>


    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .prose-about h2 {
            @apply text-3xl font-bold mt-12 mb-4 border-b pb-2;
        }

        .prose-about p {
            @apply text-lg text-gray-700 mb-4 leading-relaxed;
        }

        .prose-about a {
            @apply text-red-600 font-semibold hover:underline;
        }

        /* Style for the submit button when it's in a loading state */
        .sending {
            cursor: not-allowed;
            opacity: 0.7;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <!-- Header & Navigation (Consistent with other pages) -->
    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="index.html" class="text-2xl font-bold text-red-600">Welcome to Japan</a>
            </div>
        </nav>
    </header>

    <main>
        <!-- Page Header -->
        <section class="bg-white py-12">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900">About This Site</h1>
                <p class="mt-4 text-xl text-gray-600">Real advice from someone who made their home here.</p>
            </div>
        </section>

        <!-- Main Content Area -->
        <section class="py-12 sm:py-16">
            <div class="container mx-auto px-6 max-w-4xl">
                <div class="prose-about max-w-none">
                    <p>Hi, I'm Luke. I built this website because I am regularly asked for advice on visiting Japan by friends and family overseas, and noticed that most of their images of Japan come from the same few places and the same few things. Tokyo, Sushi, Kyoto, certain events in recent history... So, I wanted to share some of the knowledge and experiences I have built up over the decades.</p>
                    <p>I'm from the UK and first came here in 2006. I lived in Tokyo for three years, a great place for your early twenties, and of course visited Kyoto and all the usual spots early on, but came to realise that the parts of the country I most loved were elsewhere. I left Japan. lived around the world, came back, left again, came back, and then what was supposed to be another short stay turned into something permanent. I lived in a couple of different cities for a year or two but then, and for the last decade, in the countryside of Fukushima. It was never the plan, but I ended up building a family and a house here.</p>
                    <h2>Why This Website Exists</h2>
                    <p>When my friends visit, they have a great time, but they often want to do the same tourist trail. They see the famous spots, but it's busy (and getting busier), and relatively expensive. Imagine Japan - what's your image? Serene temples, relaxed dining, fun and exciting nightlife? Then you need to get away from the usual spots. The goal of this site is simple: to give you practical information so you can get off the beaten track and experience your own Japan.</p>
                    <h2>What Makes This Site Different</h2>
                    <p>The advice here comes from years of living in Japan, having a blast, then building a career, a home, a family, and eventually realising this is now my home. It's about traveling but also the practical stuff - how to navigate daily life, what things actually cost, how to deal with situations you won't read about in a guidebook. It's the information I share with friends.</p>
                    <p>Thanks for reading. I hope the information here is genuinely useful for your visit to this awesome country.</p>
                </div>
            </div>
        </section>

        <!-- Contact Form Section -->
        <section class="bg-white py-16 sm:py-20">
            <div class="container mx-auto px-6 max-w-4xl">
                <div class="text-center">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900">Have a Question or Inquiry?</h2>
                    <p class="mt-4 text-lg text-gray-600">Drop a message below. I am also available to assist with translation and/or, organising, booking, and preparing for a trip to or dealing with life in Japan. Enquire here.</p>
                </div>
                <div class="mt-12 max-w-2xl mx-auto">
                    <!-- Added an alert box for user messages -->
                    <div id="message-box" class="hidden p-4 mb-4 rounded-lg text-center" role="alert">
                        <span id="message-text" class="font-medium"></span>
                    </div>

                    <form id="contact-form" class="space-y-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Your Name</label>
                            <div class="mt-1">
                                <input type="text" name="name" id="name" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm p-3">
                            </div>
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Your Email (for follow-up)</label>
                            <div class="mt-1">
                                <input id="email" name="email" type="email" autocomplete="email" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm p-3">
                            </div>
                        </div>
                        <div>
                            <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
                            <div class="mt-1">
                                <textarea id="message" name="message" rows="4" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm p-3"></textarea>
                            </div>
                        </div>
                        <div>
                            <button id="submit-button" type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">
                                Send Message
                            </button>
                        </div>
                    </form>
                    <p id="form-status" class="mt-6 text-center text-lg font-medium"></p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 py-12 text-center">
            <p>&copy; 2024 Welcome to Japan. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // Create Lucide icons
        lucide.createIcons();

        // Get elements from the DOM
        const form = document.getElementById('contact-form');
        const formStatus = document.getElementById('form-status');
        const submitButton = document.getElementById('submit-button');

        // Main form submission logic
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Disable button and show sending status
            submitButton.disabled = true;
            submitButton.textContent = 'Sending...';
            submitButton.classList.add('sending');
            formStatus.textContent = '';
            formStatus.className = 'mt-6 text-center text-lg font-medium';

            const formData = new FormData(form);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                message: formData.get('message'),
                timestamp: new Date()
            };

            try {
                // Ensure Firebase is initialized
                if (!window.formHandler.db) {
                    throw new Error("Firebase is not initialized.");
                }

                const { addDoc, collection, db, auth, appId } = window.formHandler;
                const userId = auth.currentUser?.uid;
                
                // Add the form data to a new document in Firestore
                await addDoc(collection(db, `/artifacts/${appId}/public/data/contact-form-submissions`), data);

                formStatus.textContent = 'Thank you! Your message has been sent.';
                formStatus.classList.add('text-green-600');
                form.reset();
            } catch (error) {
                console.error('Error adding document: ', error);
                formStatus.textContent = 'Oops! There was a problem. Please try again.';
                formStatus.classList.add('text-red-600');
            } finally {
                // Re-enable the button
                submitButton.disabled = false;
                submitButton.textContent = 'Send Message';
                submitButton.classList.remove('sending');
            }
        });
    </script>
</body>
</html>
